#!/bin/bash

# Exclusive to arch
FAMILY=("arch" "artix" "endeavouros" "manjaro" "garuda")
DISTRO=$(grep '^ID=' /etc/os-release | cut -d'=' -f2 | tr -d '"')

if [[ ! ${FAMILY[@]} =~ $DISTRO ]]; then
  echo "Sorry, Arch Linux only"
  exit
fi

# Check if yay is installed
if ! command -v yay 2>&1 >/dev/null; then
  pushd /tmp/
  git clone https://aur.archlinux.org/yay.git
  pushd /tmp/yay/
  makepkg -si
  rm -rf /tmp/yay/
  popd && popd
fi

YAY() {
  local package=("$@")
  for install in "${package[@]}"
  do
    yay -S --noconfirm "${install}"
  done
}
PACMAN() {
  local package=("$@")
  for install in "${package[@]}"
  do
    sudo pacman -S --noconfirm "${install}"
  done
}

PackagesHyprland() {
  local list_pacman=(
    "grim"
    "hyprland"
    "libnotify"
    "slurp"
    "swappy"
    "swaybg"
    "swaync"
    "waybar"
    "wl-clipboard"
    "wofi"
  )

  PACMAN "${list_pacman[@]}"
}

PackagesFont() {
  local list_yay=(
    "nerd-fonts"
    "noto-fonts-cjk" 
    "noto-fonts-emoji" 
    "ttf-font-awesome"
    "ttf-hack-nerd"
    "ttf-icomoon-feather"
    "ttf-iosevka-nerd"
    "ttf-jetbrains-mono-nerd"
  )

  YAY "${list_yay[@]}"
}

PackagesEssential() {
  local list_pacman=(
    "brightnessctl"
    "fzf"
    "lazygit"
    "man"
    "npm"
    "pacman-contrib"
    "pipewire"
    "pipewire-pulse"
    "pwvucontrol"
    "ripgrep"
    "thunar"
    "tmux"
    "udiskie"
    "udisks2"
    "unzip"
    "wireplumber"
  )

  local list_yay=(
    "anki-bin"
    "kwindowsystem"
    "python-pywal16"
    "wl-color-picker"
    "zen-browser-bin"
  )

  PACMAN "${list_pacman[@]}"
  YAY "${list_yay[@]}"

  local DIR="$HOME/.config/nvim/"
  if [[ -z "$(ls -A "${DIR}")" ]]; then
    git clone https://github.com/MuteSTEVE/nvim.git "${DIR}"
  fi
}

PackagesJapanese() {
  local list_pacman=(
    "fcitx5"
    "fcitx5-configtool"
    "fcitx5-mozc"
    "ffmpeg"
    "mpv"
    "ocrfeeder"
    "tesseract"
    "tesseract-data-chi_sim"
    "tesseract-data-chi_sim_vert"
    "tesseract-data-chi_tra"
    "tesseract-data-chi_tra_vert"
    "tesseract-data-jpn"
    "tesseract-data-jpn_vert"
  )

  PACMAN "${list_pacman[@]}"

  local DIR=$HOME/.config/mpv/scripts/
  if [[ -z "$(ls -A "${DIR}")" ]]; then
    mkdir -p "$DIR"
    git clone 'https://github.com/Ajatt-Tools/mpvacious.git' "$DIR/subs2srs"
  fi
}

## To be copied
ConfigDirectories() {
  local list=(
    ".bashrc"
    ".gitconfig"
    ".config/"
    ".local/"
  )

  for copy in "${list[@]}"; do
    cp -rn "$PWD/${copy}" $HOME/
  done
  chmod +x $HOME/.local/bin/*
}

## Wallpaper from wallhaven.cc
DownloadWallpapers() {
  WALLS=(
    "https://w.wallhaven.cc/full/8o/wallhaven-8opwv2.png" # Blue Archive - Arisu
    "https://w.wallhaven.cc/full/5g/wallhaven-5gyjw3.jpg" # Blue Archive - Arisu
    "https://w.wallhaven.cc/full/1k/wallhaven-1klez3.png" # Blue Archive - Izuna
    "https://w.wallhaven.cc/full/d6/wallhaven-d62oog.png" # Blue Archive - Izuna
    "https://w.wallhaven.cc/full/p9/wallhaven-p9gzvm.jpg" # Blue Archive - Izuna
    "https://w.wallhaven.cc/full/2y/wallhaven-2yxpy6.jpg" # Blue Archive - Koyuki
    "https://w.wallhaven.cc/full/rr/wallhaven-rrep8j.jpg" # Blue Archive - Momoi
    "https://w.wallhaven.cc/full/p9/wallhaven-p9xqpm.jpg" # Blue Archive - Momoi & Midori
    "https://w.wallhaven.cc/full/we/wallhaven-wel3l7.jpg" # Blue Archive - Momoi & Midori
    "https://w.wallhaven.cc/full/9d/wallhaven-9dwr8x.png" # Blue Archive - Mutsuki
    "https://w.wallhaven.cc/full/zy/wallhaven-zyrmpg.png" # Blue Archive - Mutsuki
    "https://w.wallhaven.cc/full/gp/wallhaven-gp2xol.png" # Blue Archive - Mutsuki
  )

  local DIR=$HOME/.local/wallpapers/
  if [[ -z "$(ls -A "${DIR}")" ]]; then
    mkdir -p "$DIR"
    for img in "${WALLS[@]}"; do
      curl -O --output-dir "$DIR" "${img}"
    done
  fi
}

main() {
  ConfigDirectories
  DownloadWallpapers
  PackagesEssential
  PackagesFont
  PackagesHyprland
  PackagesJapanese
}
main
